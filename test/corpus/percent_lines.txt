================================================================================
Python line at start of file
================================================================================
%  x = 1
--------------------------------------------------------------------------------

(source_file
  (python_line
    (injected_python_line)))

================================================================================
Python line after other content
================================================================================
<p>text</p>
%  x = 1
--------------------------------------------------------------------------------

(source_file
  (injected_html)
  (python_line
    (injected_python_line)))

================================================================================
Python line can start with whitespace
================================================================================
   %  x = 1
--------------------------------------------------------------------------------

(source_file
  (python_line
    (injected_python_line)))

================================================================================
Python line cannot have printable characters before %
================================================================================
<p>text</p> %  x = 1
--------------------------------------------------------------------------------

(source_file
  (injected_html))

================================================================================
Escaped percent at start of file
================================================================================
%%
--------------------------------------------------------------------------------

(source_file
  (escaped_line_percent))

================================================================================
Whitespace can come before escaped percent
================================================================================
   %%
--------------------------------------------------------------------------------

(source_file
  (escaped_line_percent))

================================================================================
Content can come after escaped percent
================================================================================
   %%<p>text</p>
--------------------------------------------------------------------------------

(source_file
  (escaped_line_percent)
  (injected_html))

================================================================================
Content cannot come before escaped percent
================================================================================
<p>text</p>%%
--------------------------------------------------------------------------------

(source_file
  (injected_html))

================================================================================
If control line
================================================================================
% endif
--------------------------------------------------------------------------------

(source_file
  (python_line))

================================================================================
For control line
================================================================================
% endfor
--------------------------------------------------------------------------------

(source_file
  (python_line))

